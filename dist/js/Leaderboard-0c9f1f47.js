import{r as a,z as e,o as s,c as t,e as l,f as r,h as i,t as n,F as o,y as d,x as c,j as u,A as v,B as m,n as f,k as p}from"./vendor-aa0ffa31.js";import{_ as g,b as y,u as P}from"./index-c9e88ec7.js";const h={class:"leaderboard-page"},_={class:"page-header section-padding"},k={class:"container"},b={class:"header-content animate__animated animate__fadeInDown"},x={class:"page-title"},X={class:"page-subtitle"},T={class:"tier-overview animate__animated animate__fadeInUp animate__delay-1s"},w={class:"tier-grid"},R={class:"tier-header"},S={class:"tier-info"},D={class:"tier-xp"},U={class:"tier-multiplier"},F={class:"leaderboard-content section-padding"},I={class:"container"},L={key:0,class:"user-stats-card animate__animated animate__fadeInLeft"},A={class:"stats-header"},B={class:"stats-grid"},C={class:"stat-item"},j={class:"stat-content"},M={class:"stat-value"},V={class:"stat-item"},E={class:"stat-content"},N={class:"stat-value"},$={class:"stat-item"},z={class:"stat-content"},G={class:"stat-value"},H={class:"stat-item"},q={class:"stat-content"},J={class:"stat-value"},K={key:0,class:"tier-progress"},O={class:"progress-header"},Q={class:"progress-bar"},W={class:"leaderboard-filters animate__animated animate__fadeInRight"},Y={class:"filter-group"},Z={class:"filter-group"},aa=["value"],ea={class:"leaderboard-table animate__animated animate__fadeInUp animate__delay-2s"},sa={key:0,class:"loading-state"},ta={key:1,class:"empty-state"},la={key:2,class:"leaderboard-list"},ra={class:"rank-col"},ia={key:0,class:"fas fa-crown"},na={key:1,class:"fas fa-medal"},oa={key:2,class:"fas fa-award"},da={key:3},ca={class:"player-col"},ua={class:"player-info"},va={class:"player-details"},ma={class:"player-name"},fa={key:0,class:"player-status"},pa={class:"stats-col"},ga={class:"player-stats"},ya={class:"stat-primary"},Pa={class:"stat-value"},ha={class:"stat-unit"},_a={class:"stat-secondary"},ka={class:"mini-stat"},ba={class:"mini-stat"},xa={class:"tier-col"};const Xa=g({name:"Leaderboard",setup(){const t=y(),l=P(),r=a(!1),i=a([]),n=a("xp"),o=a(""),d=[{name:"Rookie",xpRange:"0-49 XP",multiplier:1,color:"#666666",icon:"fas fa-user",minXP:0,maxXP:49},{name:"Novice",xpRange:"50-149 XP",multiplier:1.2,color:"#0088ff",icon:"fas fa-user-plus",minXP:50,maxXP:149},{name:"Intermediate",xpRange:"150-449 XP",multiplier:1.4,color:"#ff8800",icon:"fas fa-user-graduate",minXP:150,maxXP:449},{name:"Pro",xpRange:"450-999 XP",multiplier:1.6,color:"#ff0088",icon:"fas fa-user-tie",minXP:450,maxXP:999},{name:"Elite",xpRange:"1000-1599 XP",multiplier:1.8,color:"#8800ff",icon:"fas fa-crown",minXP:1e3,maxXP:1599},{name:"Unreal",xpRange:"1600+ XP",multiplier:2,color:"#00A19C",icon:"fas fa-star",minXP:1600,maxXP:1/0}],c=e(()=>{var a;return(null==(a=t.userTier)?void 0:a.name)||"Rookie"}),u=e(()=>{let a=[...i.value];return o.value&&(a=a.filter(a=>h(a).name===o.value)),a.sort((a,e)=>{switch(n.value){case"xp":default:return p(e)-p(a);case"time":return(e.total_time_played||0)-(a.total_time_played||0);case"tokens":return g(e)-g(a)}}),a}),v=e(()=>{if(!t.user)return null;const a=u.value.findIndex(a=>a.id===t.user.id);return a>=0?a+1:null}),m=e(()=>{if(!t.user)return null;const a=t.userXP,e=d.find(e=>a>=e.minXP&&a<=e.maxXP);if(!e||"Unreal"===e.name)return null;const s=d.find(a=>a.minXP>e.maxXP);return s?{nextTier:s.name,current:a,target:s.minXP,percentage:Math.min(100,a/s.minXP*100)}:null}),f=async()=>{r.value=!0;try{let e;try{e=await fetch("/api/leaderboard?limit=50")}catch(a){e=await fetch("http://localhost:3001/api/leaderboard?limit=50")}if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const s=await e.json();if(!s.success||!s.leaderboard)throw new Error(s.error||"API returned no data");i.value=[...s.leaderboard]}catch(e){i.value=[{id:1,username:"Тест потребител (Fallback)",total_time_played:60,xp:100,level:"Novice",tokens:120,total_time_minutes:60,total_sessions:1}]}finally{r.value=!1}},p=a=>a.xp||0,g=a=>a.tokens||0,h=a=>{const e=p(a);return e>=1600?d[5]:e>=1e3?d[4]:e>=450?d[3]:e>=150?d[2]:e>=50?d[1]:d[0]};return s(()=>{f()}),{languageStore:l,authStore:t,loading:r,leaderboard:i,filterBy:n,tierFilter:o,tiers:d,currentUserTier:c,filteredLeaderboard:u,userRank:v,nextTierProgress:m,loadLeaderboard:f,getTierForPlayer:h,getDisplayValue:a=>{switch(n.value){case"xp":default:return p(a);case"time":return Math.floor((a.total_time_played||0)/60);case"tokens":return g(a)}},getDisplayUnit:()=>{switch(n.value){case"xp":default:return"XP";case"time":return"часа";case"tokens":return"токена"}},getRankClass:a=>1===a?"rank-1":2===a?"rank-2":3===a?"rank-3":"",formatDate:a=>new Date(a).toLocaleDateString("bg-BG",{day:"2-digit",month:"2-digit",year:"numeric"}),getPlayerTokens:g,getPlayerXP:p}}},[["render",function(a,e,s,g,y,P){var Xa;return t(),l("div",h,[r("div",_,[r("div",k,[r("div",b,[r("h1",x,[e[3]||(e[3]=r("i",{class:"fas fa-crown"},null,-1)),i(" "+n(g.languageStore.t("leaderboardTitle")),1)]),r("p",X,n(g.languageStore.t("topDrivers")),1)]),r("div",T,[e[4]||(e[4]=r("h3",{class:"tier-title"},"Система от нива",-1)),r("div",w,[(t(!0),l(o,null,d(g.tiers,a=>(t(),l("div",{key:a.name,class:f(["tier-card",{current:g.currentUserTier===a.name}])},[r("div",R,[r("div",{class:"tier-icon",style:c({color:a.color})},[r("i",{class:f(a.icon)},null,2)],4),r("div",S,[r("h4",{class:"tier-name",style:c({color:a.color})},n(a.name),5),r("div",D,n(a.xpRange),1)])]),r("div",U,n(a.multiplier)+"x множител ",1)],2))),128))])])])]),r("div",F,[r("div",I,[g.authStore.isAuthenticated?(t(),l("div",L,[r("div",A,[e[5]||(e[5]=r("h3",null,"Вашата статистика",-1)),r("div",{class:"user-tier-badge",style:c({backgroundColor:g.authStore.userTier.color})},n(g.authStore.userTier.name),5)]),r("div",B,[r("div",C,[e[7]||(e[7]=r("div",{class:"stat-icon"},[r("i",{class:"fas fa-star"})],-1)),r("div",j,[r("div",M,n(g.authStore.userXP||0),1),e[6]||(e[6]=r("div",{class:"stat-label"},"XP",-1))])]),r("div",V,[e[9]||(e[9]=r("div",{class:"stat-icon"},[r("i",{class:"fas fa-coins"})],-1)),r("div",E,[r("div",N,n(g.authStore.userTokens||0),1),e[8]||(e[8]=r("div",{class:"stat-label"},"Токени",-1))])]),r("div",$,[e[11]||(e[11]=r("div",{class:"stat-icon"},[r("i",{class:"fas fa-clock"})],-1)),r("div",z,[r("div",G,n(Math.floor(((null==(Xa=g.authStore.user)?void 0:Xa.total_time_played)||0)/60)),1),e[10]||(e[10]=r("div",{class:"stat-label"},"Часа",-1))])]),r("div",H,[e[13]||(e[13]=r("div",{class:"stat-icon"},[r("i",{class:"fas fa-trophy"})],-1)),r("div",q,[r("div",J,n(g.userRank||"N/A"),1),e[12]||(e[12]=r("div",{class:"stat-label"},"Позиция",-1))])])]),g.nextTierProgress?(t(),l("div",K,[r("div",O,[r("span",null,"Прогрес към "+n(g.nextTierProgress.nextTier),1),r("span",null,n(g.nextTierProgress.current)+" / "+n(g.nextTierProgress.target)+" XP",1)]),r("div",Q,[r("div",{class:"progress-fill",style:c({width:g.nextTierProgress.percentage+"%"})},null,4)])])):u("",!0)])):u("",!0),r("div",W,[r("div",Y,[e[15]||(e[15]=r("label",{class:"filter-label"},"Покажи по:",-1)),v(r("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>g.filterBy=a),class:"filter-select"},e[14]||(e[14]=[r("option",{value:"xp"},"XP (опит)",-1),r("option",{value:"time"},"Време за игра",-1),r("option",{value:"tokens"},"Токени",-1)]),512),[[m,g.filterBy]])]),r("div",Z,[e[17]||(e[17]=r("label",{class:"filter-label"},"Нивo:",-1)),v(r("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>g.tierFilter=a),class:"filter-select"},[e[16]||(e[16]=r("option",{value:""},"Всички нива",-1)),(t(!0),l(o,null,d(g.tiers,a=>(t(),l("option",{key:a.name,value:a.name},n(a.name),9,aa))),128))],512),[[m,g.tierFilter]])]),r("button",{onClick:e[2]||(e[2]=(...a)=>g.loadLeaderboard&&g.loadLeaderboard(...a)),class:"btn-secondary refresh-btn"},[r("i",{class:f(["fas fa-sync-alt",{"fa-spin":g.loading}])},null,2),e[18]||(e[18]=i(" Обнови "))])]),r("div",ea,[g.loading?(t(),l("div",sa,e[19]||(e[19]=[r("i",{class:"fas fa-spinner fa-spin"},null,-1),r("span",null,"Зареждане на класацията...",-1)]))):0===g.filteredLeaderboard.length?(t(),l("div",ta,e[20]||(e[20]=[r("i",{class:"fas fa-users-slash"},null,-1),r("span",null,"Няма данни за показване",-1)]))):(t(),l("div",la,[e[24]||(e[24]=p('<div class="leaderboard-header" data-v-a398d195><div class="rank-col" data-v-a398d195>Позиция</div><div class="player-col" data-v-a398d195>Играч</div><div class="stats-col" data-v-a398d195>Статистики</div><div class="tier-col" data-v-a398d195>Ниво</div></div>',1)),(t(!0),l(o,null,d(g.filteredLeaderboard,(a,s)=>{var o;return t(),l("div",{key:a.id,class:f(["leaderboard-row",{highlight:a.id===(null==(o=g.authStore.user)?void 0:o.id),"top-3":s<3}])},[r("div",ra,[r("div",{class:f(["rank-number",g.getRankClass(s+1)])},[0===s?(t(),l("i",ia)):1===s?(t(),l("i",na)):2===s?(t(),l("i",oa)):(t(),l("span",da,n(s+1),1))],2)]),r("div",ca,[r("div",ua,[e[21]||(e[21]=r("div",{class:"player-avatar"},[r("i",{class:"fas fa-user-circle"})],-1)),r("div",va,[r("div",ma,n(a.username),1),a.last_login?(t(),l("div",fa," Последен: "+n(g.formatDate(a.last_login)),1)):u("",!0)])])]),r("div",pa,[r("div",ga,[r("div",ya,[r("span",Pa,n(g.getDisplayValue(a)),1),r("span",ha,n(g.getDisplayUnit()),1)]),r("div",_a,[r("div",ka,[e[22]||(e[22]=r("i",{class:"fas fa-clock"},null,-1)),i(" "+n(Math.floor((a.total_time_played||0)/60))+"ч ",1)]),r("div",ba,[e[23]||(e[23]=r("i",{class:"fas fa-coins"},null,-1)),i(" "+n(g.getPlayerTokens(a)),1)])])])]),r("div",xa,[r("div",{class:"player-tier",style:c({color:g.getTierForPlayer(a).color})},[r("i",{class:f(g.getTierForPlayer(a).icon)},null,2),r("span",null,n(g.getTierForPlayer(a).name),1)],4)])],2)}),128))]))])])])])}],["__scopeId","data-v-a398d195"]]);export{Xa as default};
